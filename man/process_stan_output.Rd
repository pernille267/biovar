% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/process_stan_output.R
\name{process_stan_output}
\alias{process_stan_output}
\title{Process and Summarize Stan Model Output}
\usage{
process_stan_output(
  fit,
  log_transformed,
  analyte = "X",
  material = "Unknown",
  sex = "Unknown",
  group = "Y",
  data = NULL,
  digits = 1L
)
}
\arguments{
\item{fit}{An object, typically a \code{list} generated from
\code{rstan::extract}, containing the posterior draws from the Stan model.
It is expected to contain vectors and matrices of draws for parameters
like \code{beta}, \code{sigma_I}, \code{sigma_A}, \code{sigma_G},
\code{df_I}, \code{df_A}, etc.}

\item{log_transformed}{A \code{logical} value. If \code{TRUE}, it assumes the model
was fitted on log-transformed data, and results (like \code{beta}) are
back-transformed. CV calculations are also adjusted accordingly.}

\item{analyte}{A \code{character} string used to label the measurand in the
output tables. Defaults to "X".}

\item{material}{A \code{character} string to label the biological material.}

\item{sex}{A \code{character} string to label the sex. Defaults to "Unknown".}

\item{group}{A \code{character} string used to label the group or cohort in
the output tables. Defaults to "Y".}

\item{data}{An optional \code{data.frame} or \code{data.table} containing the
original input data. If provided, its \code{SubjectID} column will be used to
label the subjects in the subject-specific output table.
Defaults to \code{NULL}.}

\item{digits}{An \code{integer} specifying the number of decimal places to use
when formatting the credible intervals. Defaults to 1.}
}
\value{
A \code{list} containing three \code{data.table} objects:
\describe{
  \item{Table 1}{A single-row summary table containing the overall model
    estimates, including mean concentration, CVI, CVG, CVA, the distribution
    of the predictive within-subject CV, and the HBHR, all with 95\% credible
    intervals.}
  \item{Table 2}{A subject-specific table showing the individual within-subject
    CV (\code{CV_P(i)}) for each subject, including the mean, median, and 95\%
    credible interval. Subjects are ordered by their median \code{CV_P(i)}.}
  \item{Table 3}{A summary table for the model's degrees of freedom
    parameters (\code{df_I} and \code{df_A}), showing their mean values and 95\%
    credible intervals.}
}
}
\description{
Takes the posterior draws from a Stan model fit and computes key biological
and analytical metrics, such as coefficients of variation (CVs) and credible
intervals, formatting them into user-friendly tables.
}
\details{
This function serves as the primary post-processing step. It calculates the
mean concentration, within-subject CV (\code{CVI}), between-subject CV (\code{CVG}),
and analytical CV (\code{CVA}) from the posterior distributions.
It handles calculations differently depending on whether the model was run on a
log-transformed scale. The function also computes the distribution of the
predictive within-subject CV (\code{dCV_P(i)}) and the heterogeneity of this
distribution (HBHR).
}
\section{Calculation of CVs}{

The method for calculating CVs depends on the \code{log_transformed} flag.
\itemize{
  \item \strong{If \code{log_transformed = TRUE}:} The function assumes that
    variance components (\code{sigma} parameters) are on the natural log scale.
    It uses the appropriate formulas to convert these into CVs on the original
    scale. For parameters with Student-t distributions (\code{sigma_I}, \code{sigma_A}),
    it accounts for the degrees of freedom (\code{df}).
  \item \strong{If \code{log_transformed = FALSE}:} The function assumes a model on the
    identity scale. CVs are calculated as \code{sd / mean * 100}. The standard
    deviation for t-distributed parameters is derived from the scale parameter
    (\code{sigma}) and degrees of freedom (\code{df}).
}
}

\section{Important Note on Model Validity}{

The reliability of the metrics produced by this function depends entirely
on the quality and convergence of the Stan model fit. Before trusting the
output, it is essential to perform standard MCMC diagnostics (e.g., check for
divergent transitions, R-hat < 1.01, and sufficient \code{n_eff}).
}

\seealso{
\code{\link{plot_subject_specific_CVI}} for visualizing the results.
}
